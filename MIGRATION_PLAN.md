# üì¶ –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ PWA Scanner Logger —Å Google Sheets –Ω–∞ VM + PostgreSQL

## üéØ –¶–µ–ª—å
–ú–∏–≥—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —à—Ç—Ä–∏—Ö–∫–æ–¥–æ–≤ —Å Google Apps Script + Sheets –Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å FastAPI + PostgreSQL –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏.

---

## üìä –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã (AS-IS)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```
PWA Frontend (GitHub Pages)
    ‚Üì POST batch (3 —Å–∫–∞–Ω–∞ / 3 —Å–µ–∫)
Google Apps Script (Backend)
    ‚Üì LockService + Cache
Google Sheets (–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
    ‚Üì raw_log_YYYY_MM
–¢–∞–±–ª–∏—Ü—ã –ø–æ –º–µ—Å—è—Ü–∞–º
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (–∏–∑ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ Google Sheets)

**–û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ª–æ–≥–æ–≤ (`raw_log_YYYY_MM`)**:
```
uuid          - UUID —Å–æ–±—ã—Ç–∏—è (–ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á, –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è)
ts            - Timestamp (dd.MM.yyyy HH:mm:ss)
type          - –¢–∏–ø —Å–æ–±—ã—Ç–∏—è: ITEM, BOX, CLOSE, CITY, CITY_CLOSE, ERROR, REMOVE, BULK_REMOVE
operator      - –ò–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (testscanner, ivancov –∏ —Ç.–¥.)
client        - –ö–ª–∏–µ–Ω—Ç (ivancov)
city          - –ì–æ—Ä–æ–¥ (Novosem)
box           - –ö–æ—Ä–æ–± (ivancov/8, ivancov/9 –∏ —Ç.–¥.)
code          - –®—Ç—Ä–∏—Ö–∫–æ–¥ —Ç–æ–≤–∞—Ä–∞ –∏–ª–∏ –∫–æ–¥ —Å–æ–±—ã—Ç–∏—è
details       - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ (–ø—É—Å—Ç–æ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º)
receivedAt    - –í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–æ–º (dd.MM.yyyy HH:mm:ss)
source        - –ò—Å—Ç–æ—á–Ω–∏–∫ (pwa, dashboard)
```

### –ü—Ä–∏–º–µ—Ä—ã —Å–æ–±—ã—Ç–∏–π –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
1. **ITEM** - –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
   ```
   uuid: c6414b06-0ea0-48ff-858c-7bd70d8b7581
   ts: 10.10.2025 13:39:30
   type: ITEM
   operator: testscanner
   client: ivancov
   city: Novosem
   box: ivancov/8
   code: 2042469234860 (—à—Ç—Ä–∏—Ö–∫–æ–¥)
   source: pwa
   ```

2. **BOX** - –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–æ—Ä–æ–±–∞
3. **CLOSE** - –ó–∞–∫—Ä—ã—Ç–∏–µ –∫–æ—Ä–æ–±–∞
4. **CITY** - –û—Ç–∫—Ä—ã—Ç–∏–µ –≥–æ—Ä–æ–¥–∞
5. **CITY_CLOSE** - –ó–∞–∫—Ä—ã—Ç–∏–µ –≥–æ—Ä–æ–¥–∞
6. **ERROR** - –û—à–∏–±–∫–∏ (NO_BOX, BOX_NOT_CLOSED, CYRILLIC_ERROR –∏ —Ç.–¥.)

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã
- ‚è±Ô∏è –í—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ batch (3 —Å–∫–∞–Ω–∞): ~3000 –º—Å
- üîÑ –ú–µ—Ö–∞–Ω–∏–∑–º –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏: UUID –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ Sheets + Cache (10-30 –º–∏–Ω)
- üîí Lock –º–µ—Ö–∞–Ω–∏–∑–º: LockService.getScriptLock() (–¥–æ 30 —Å–µ–∫)
- üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–∏–∑ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞): ~45 –∑–∞–ø–∏—Å–µ–π –∑–∞ 5 –º–∏–Ω—É—Ç

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª Apps Script

#### API Endpoints (doPost + doGet)
1. **POST /** - –û—Å–Ω–æ–≤–Ω–æ–π endpoint –¥–ª—è –ø—Ä–∏–µ–º–∞ –±–∞—Ç—á–µ–π —Å–∫–∞–Ω–æ–≤
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç—ã: `{events:[...]}`, `{api:'ingest', records:[...]}`, `{rows:[...]}`
   - –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ UUID (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ–π —Ç–∞–±–ª–∏—Ü—ã + Cache)
   - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –º–µ—Å—è—Ü–∞–º (`raw_log_YYYY_MM`)

2. **GET /?api=has_uuids** - Verify-ACK (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö UUID)
3. **GET /?api=state** - –î–∞—à–±–æ—Ä–¥: —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
4. **GET /?api=boxes** - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–æ—Ä–æ–±–∞–º
5. **GET /?api=clients** - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º
6. **GET /?api=raw** - –°—ã—Ä—ã–µ –ª–æ–≥–∏
7. **GET /?api=export** - CSV —ç–∫—Å–ø–æ—Ä—Ç
8. **GET /?api=export_gs** - –≠–∫—Å–ø–æ—Ä—Ç –≤ Google Sheets
9. **GET /?api=export_gs_range** - –≠–∫—Å–ø–æ—Ä—Ç –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–∞—Ç
10. **GET /?api=remove_item** - –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
11. **GET /?api=bulk_remove_items** - –ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
12. **GET /?api=removal_logs** - –õ–æ–≥–∏ —É–¥–∞–ª–µ–Ω–∏–π

#### Dashboard —Ñ—É–Ω–∫—Ü–∏–∏
- –û–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ (5 –º–∏–Ω –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏)
- –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º/–∫–ª–∏–µ–Ω—Ç–∞–º/–∫–æ—Ä–æ–±–∞–º
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (10 —Å–µ–∫ TTL)
- –õ–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 100 —Å–æ–±—ã—Ç–∏–π

### PWA Frontend —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- üì± Offline-first: IndexedDB –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è
- üîÑ –ë–∞—Ç—á–∏–Ω–≥: 3 —Å–∫–∞–Ω–∞ –∏–ª–∏ 3 —Å–µ–∫—É–Ω–¥—ã –∑–∞–¥–µ—Ä–∂–∫–∏
- üéôÔ∏è –ì–æ–ª–æ—Å–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (SpeechSynthesis API)
- üîê –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–∏—Ä–∏–ª–ª–∏—Ü—É –≤ QR-–∫–æ–¥–∞—Ö
- ‚è∞ –ê–≤—Ç–æ–∑–∞–∫—Ä—ã—Ç–∏–µ –∫–æ—Ä–æ–±–æ–≤ —á–µ—Ä–µ–∑ 60 –º–∏–Ω—É—Ç
- üîÑ –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (–∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É)

---

## üöÄ –¶–µ–ª–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (TO-BE)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    VM (Yandex Cloud / VK Cloud)            ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ Nginx (Reverse Proxy + Static PWA files)             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ :80/:443 ‚Üí Let's Encrypt SSL                         ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                    ‚îÇ                                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ FastAPI Backend                                      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ :8000 (internal)                                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - REST API endpoints                                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - Pydantic validation                                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - SQLAlchemy ORM                                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - Redis cache (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)                         ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                    ‚îÇ                                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ PostgreSQL 15+                                       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ :5432 (internal)                                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - –¢–∞–±–ª–∏—Ü–∞ events (–ª–æ–≥–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π)                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - –ò–Ω–¥–µ–∫—Å—ã –ø–æ uuid, operator, client, date           ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –º–µ—Å—è—Ü–∞–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)        ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚ñ≤
         ‚îÇ HTTPS (fetch API)
         ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   PWA Frontend   ‚îÇ
‚îÇ (GitHub Pages)   ‚îÇ
‚îÇ - Same UI        ‚îÇ
‚îÇ - New API URL    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üóÑÔ∏è –°—Ö–µ–º–∞ PostgreSQL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ `events`
```sql
CREATE TABLE events (
    uuid            UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    ts              TIMESTAMP WITH TIME ZONE NOT NULL,
    type            VARCHAR(50) NOT NULL, -- ITEM, BOX, CLOSE, CITY, etc.
    operator        VARCHAR(100) NOT NULL,
    client          VARCHAR(100),
    city            VARCHAR(100),
    box             VARCHAR(100),
    code            VARCHAR(500),
    details         TEXT,
    received_at     TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    source          VARCHAR(50) DEFAULT 'pwa',
    created_at      TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    
    -- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –≤—ã–±–æ—Ä–æ–∫
    INDEX idx_events_ts (ts DESC),
    INDEX idx_events_operator (operator, ts DESC),
    INDEX idx_events_client (client, ts DESC),
    INDEX idx_events_type (type, ts DESC),
    INDEX idx_events_box (box, ts DESC),
    INDEX idx_events_date (DATE(ts), operator),
    INDEX idx_events_received_at (received_at DESC)
);

-- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
CREATE UNIQUE INDEX idx_events_uuid ON events(uuid);

-- –°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å –¥–ª—è dashboard –∑–∞–ø—Ä–æ—Å–æ–≤
CREATE INDEX idx_dashboard ON events(operator, client, ts DESC) 
    WHERE ts > NOW() - INTERVAL '24 hours';
```

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ç–æ–≤ (–∫—ç—à)
```sql
CREATE TABLE operator_stats_cache (
    operator        VARCHAR(100) PRIMARY KEY,
    date            DATE NOT NULL,
    items_count     INTEGER DEFAULT 0,
    boxes_opened    INTEGER DEFAULT 0,
    boxes_closed    INTEGER DEFAULT 0,
    errors_count    INTEGER DEFAULT 0,
    last_activity   TIMESTAMP WITH TIME ZONE,
    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);
```

---

## üîå REST API Endpoints (FastAPI)

### 1. –ü—Ä–∏–µ–º —Å–∫–∞–Ω–æ–≤ (–æ—Å–Ω–æ–≤–Ω–æ–π endpoint)
```http
POST /api/v1/events/batch
Content-Type: application/json

{
  "events": [
    {
      "uuid": "c6414b06-0ea0-48ff-858c-7bd70d8b7581",
      "ts": 1728562770000,  // Unix timestamp –≤ ms
      "type": "ITEM",
      "operator": "testscanner",
      "client": "ivancov",
      "city": "Novosem",
      "box": "ivancov/8",
      "code": "2042469234860"
    }
  ]
}

Response:
{
  "ok": true,
  "inserted": 1,
  "skipped": 0,
  "duplicates": []
}
```

### 2. Verify-ACK (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö UUID)
```http
POST /api/v1/events/verify
{
  "uuids": ["uuid1", "uuid2", "uuid3"]
}

Response:
{
  "ok": true,
  "present": ["uuid1"]  // UUID –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –µ—Å—Ç—å –≤ –ë–î
}
```

### 3. Dashboard - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
```http
GET /api/v1/dashboard/state?date=2025-10-31&operator=testscanner&client=ivancov

Response:
{
  "generatedAt": "2025-10-31T15:30:00Z",
  "operators": [
    {
      "operator": "testscanner",
      "online": true,
      "onlineAgeSec": 45,
      "lastSeenMs": 1730390000000,
      "lastClient": "ivancov",
      "lastCity": "Novosem",
      "lastBox": "ivancov/8",
      "itemsToday": 150,
      "errorsToday": 2,
      "lastSeenAt": "31.10.2025 15:29:15"
    }
  ],
  "clients": [...],
  "feed": [...],
  "summary": {
    "items": 450,
    "opens": 12,
    "closes": 10,
    "errors": 3
  }
}
```

### 4. –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–æ—Ä–æ–±–∞–º
```http
GET /api/v1/dashboard/boxes?date=2025-10-31&client=ivancov

Response:
{
  "clients": [
    {
      "client": "ivancov",
      "cities": [
        {
          "city": "Novosem",
          "boxes": [
            {
              "boxNo": "8",
              "itemsCount": 25,
              "firstAt": "31.10.2025 13:39:30",
              "lastAt": "31.10.2025 15:29:15",
              "operators": ["testscanner"],
              "items": [...]
            }
          ]
        }
      ]
    }
  ]
}
```

### 5. –°—ã—Ä—ã–µ –ª–æ–≥–∏
```http
GET /api/v1/logs/raw?date=2025-10-31&operator=testscanner

Response:
{
  "logs": [
    {
      "uuid": "...",
      "ts": "31.10.2025 15:29:15",
      "type": "ITEM",
      "operator": "testscanner",
      "client": "ivancov",
      "city": "Novosem",
      "box": "ivancov/8",
      "code": "2042469234860",
      "receivedAt": "31.10.2025 15:29:16"
    }
  ]
}
```

### 6. –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
```http
GET /api/v1/export/csv?date=2025-10-31&client=ivancov

Response: (CSV file download)
```

### 7. –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
```http
POST /api/v1/events/remove
{
  "operator": "testscanner",
  "box": "ivancov/8",
  "code": "2042469234860",
  "reason": "–û—à–∏–±–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è"
}
```

### 8. –ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
```http
POST /api/v1/events/bulk-remove
{
  "operator": "testscanner",
  "uuids": ["uuid1", "uuid2"],
  "reason": "–ú–∞—Å—Å–æ–≤–∞—è –æ—à–∏–±–∫–∞"
}
```

---

## üõ†Ô∏è –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

### Backend
- **Python 3.11+**
- **FastAPI** 0.104+ (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫)
- **SQLAlchemy** 2.0+ (ORM)
- **Pydantic** 2.5+ (–≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö)
- **asyncpg** (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä PostgreSQL)
- **Redis** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è)
- **Uvicorn** (ASGI —Å–µ—Ä–≤–µ—Ä)

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **PostgreSQL** 15+ (–æ—Å–Ω–æ–≤–Ω–∞—è –ë–î)
- **pg_partman** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º)

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **Docker** + **Docker Compose**
- **Nginx** (reverse proxy + —Å—Ç–∞—Ç–∏–∫–∞)
- **Let's Encrypt** (SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã)
- **systemd** –∏–ª–∏ **PM2** (–∞–≤—Ç–æ–∑–∞–ø—É—Å–∫)

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- **Prometheus** + **Grafana**
- **PostgreSQL Exporter**

---

## üìã –≠—Ç–∞–ø—ã –º–∏–≥—Ä–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚úÖ
- [x] –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–¥–∞ Apps Script
- [x] –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã PostgreSQL
- [x] –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ API endpoints
- [ ] –í—ã–±–æ—Ä VM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (Yandex Cloud / VK Cloud)

### –≠—Ç–∞–ø 2: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ Backend
1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è FastAPI –ø—Ä–æ–µ–∫—Ç–∞
2. –ú–æ–¥–µ–ª–∏ SQLAlchemy (events, operator_stats_cache)
3. Pydantic —Å—Ö–µ–º—ã (–≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö)
4. API endpoints:
   - POST /api/v1/events/batch (–æ—Å–Ω–æ–≤–Ω–æ–π)
   - POST /api/v1/events/verify (verify-ACK)
   - GET /api/v1/dashboard/state
   - GET /api/v1/dashboard/boxes
   - GET /api/v1/logs/raw
   - POST /api/v1/events/remove
   - GET /api/v1/export/csv
5. Middleware –¥–ª—è CORS, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
6. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
7. Unit —Ç–µ—Å—Ç—ã (pytest)

### –≠—Ç–∞–ø 3: –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
1. –°–∫—Ä–∏–ø—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞ –∏–∑ Google Sheets (Python + gspread)
2. –ü–∞—Ä—Å–∏–Ω–≥ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞—Ç—ã `dd.MM.yyyy HH:mm:ss`
3. –ò–º–ø–æ—Ä—Ç –≤ PostgreSQL —á–µ—Ä–µ–∑ SQLAlchemy
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ (–ø–æ–¥—Å—á–µ—Ç –∑–∞–ø–∏—Å–µ–π, —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π)
5. –ë—ç–∫–∞–ø –¥–∞–Ω–Ω—ã—Ö

### –≠—Ç–∞–ø 4: –ê–¥–∞–ø—Ç–∞—Ü–∏—è PWA Frontend
1. –ò–∑–º–µ–Ω–∏—Ç—å `SYNC_URL` –Ω–∞ –Ω–æ–≤—ã–π API endpoint
2. –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏:
   - –§–æ—Ä–º–∞—Ç –¥–∞—Ç—ã: Unix timestamp –≤ –º—Å (—É–∂–µ —Ç–∞–∫)
   - Content-Type: application/json
3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤
4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ offline —Ä–µ–∂–∏–º–∞
5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Service Worker

### –≠—Ç–∞–ø 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ VM –∏ Docker
1. –°–æ–∑–¥–∞—Ç—å VM (1-2 vCPU, 2-4GB RAM)
2. Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
   - PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
   - FastAPI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
   - Nginx –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
   - Redis –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx:
   - Reverse proxy –¥–ª—è API
   - –°—Ç–∞—Ç–∏–∫–∞ –¥–ª—è PWA (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
   - SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (Let's Encrypt)
4. Environment variables (.env —Ñ–∞–π–ª)
5. Docker volumes –¥–ª—è –¥–∞–Ω–Ω—ã—Ö

### –≠—Ç–∞–ø 6: –î–µ–ø–ª–æ–π –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ VM
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–º–µ–Ω–∞ –∏ DNS
3. SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (certbot)
4. –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Apache Bench / Locust)
5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫:
   - –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å < 50ms)
   - –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ PostgreSQL
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏/CPU

### –≠—Ç–∞–ø 7: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫
1. PWA –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ –æ–±–∞ —Å–µ—Ä–≤–µ—Ä–∞ (—Å—Ç–∞—Ä—ã–π + –Ω–æ–≤—ã–π)
2. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —Ç–∏–ø—ã —Å–æ–±—ã—Ç–∏–π)
3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ (–ª–æ–≥–∏ FastAPI vs Apps Script)
4. –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### –≠—Ç–∞–ø 8: –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥
1. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å PWA —Ç–æ–ª—å–∫–æ –Ω–∞ –Ω–æ–≤—ã–π API
2. –û—Ç–∫–ª—é—á–∏—Ç—å Apps Script endpoint (–∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å read-only)
3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–µ—Ä–≤—ã—Ö 48 —á–∞—Å–æ–≤
4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±—ç–∫–∞–ø–æ–≤ PostgreSQL (pg_dump –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤)

---

## ‚ö° –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
| –ú–µ—Ç—Ä–∏–∫–∞ | –°–µ–π—á–∞—Å (Google Sheets) | –ü–æ—Å–ª–µ (PostgreSQL) | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|------------------------|-------------------|-----------|
| –í—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ batch (3 —Å–∫–∞–Ω–∞) | ~3000 –º—Å | < 50 –º—Å | **60x –±—ã—Å—Ç—Ä–µ–µ** |
| –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è | –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü—ã | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å | **100x –±—ã—Å—Ç—Ä–µ–µ** |
| Dashboard –∑–∞–≥—Ä—É–∑–∫–∞ | ~2000 –º—Å | < 200 –º—Å | **10x –±—ã—Å—Ç—Ä–µ–µ** |
| –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã | 1-2 (Lock) | 100+ | **50x –±–æ–ª—å—à–µ** |

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- ‚úÖ 99.9% uptime (vs ~95% —É Google Sheets API)
- ‚úÖ –ù–µ—Ç –∫–≤–æ—Ç –∏ –ª–∏–º–∏—Ç–æ–≤ API
- ‚úÖ –ê—Ç–æ–º–∞—Ä–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- ‚úÖ ACID –≥–∞—Ä–∞–Ω—Ç–∏–∏
- ‚úÖ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å–∏—Å—Ç–µ–º–æ–π

### –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 100+ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–∫–∞–Ω–µ—Ä–æ–≤
- ‚úÖ –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –º–µ—Å—è—Ü–∞–º (–ø—Ä–∏ —Ä–æ—Å—Ç–µ –¥–∞–Ω–Ω—ã—Ö)
- ‚úÖ –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (read replicas)
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Redis

---

## üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### Yandex Cloud (–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–æ)
- **VM**: 2 vCPU, 4GB RAM, 20GB SSD = ~800‚ÇΩ/–º–µ—Å
- **IP –∞–¥—Ä–µ—Å**: ~150‚ÇΩ/–º–µ—Å
- **–¢—Ä–∞—Ñ–∏–∫**: –¥–æ 100GB = –±–µ—Å–ø–ª–∞—Ç–Ω–æ
- **–ò—Ç–æ–≥–æ**: ~950‚ÇΩ/–º–µ—Å

### VK Cloud (–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–æ)
- **VM**: 2 vCPU, 4GB RAM, 20GB SSD = ~600‚ÇΩ/–º–µ—Å
- **IP –∞–¥—Ä–µ—Å**: –±–µ—Å–ø–ª–∞—Ç–Ω–æ
- **–¢—Ä–∞—Ñ–∏–∫**: –¥–æ 100GB = –±–µ—Å–ø–ª–∞—Ç–Ω–æ
- **–ò—Ç–æ–≥–æ**: ~600‚ÇΩ/–º–µ—Å

**–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å Google Sheets**:
- Google Sheets (–±–µ—Å–ø–ª–∞—Ç–Ω–æ, –Ω–æ –ª–∏–º–∏—Ç—ã + –Ω–∏–∑–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
- –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞: ~600-950‚ÇΩ/–º–µ—Å, **–Ω–æ –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –∏ –≤ 60 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ**

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
1. **API Key** –¥–ª—è PWA (–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è)
2. **Bearer Token** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
3. **Rate limiting** (100 req/min –Ω–∞ IP)

### –ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
- SSL/TLS —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ (Let's Encrypt)
- PostgreSQL: SSL —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- Environment variables –¥–ª—è —Å–µ–∫—Ä–µ—Ç–æ–≤ (.env —Ñ–∞–π–ª)
- –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –±—ç–∫–∞–ø—ã (pg_dump)

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
1. **API Performance**:
   - –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ (p50, p95, p99)
   - RPS (requests per second)
   - –û—à–∏–±–∫–∏ (4xx, 5xx)

2. **Database**:
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
   - –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (> 100ms)
   - –†–∞–∑–º–µ—Ä –ë–î

3. **System**:
   - CPU usage
   - Memory usage
   - Disk I/O

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- FastAPI: structured logging (JSON format)
- Nginx: access logs + error logs
- PostgreSQL: slow query log

---

## üö® –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|------------|-------------|-----------|
| –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ | –ù–∏–∑–∫–∞—è | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ | –ë—ç–∫–∞–ø Sheets –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ |
| –û—à–∏–±–∫–∏ –≤ –Ω–æ–≤–æ–º API | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–æ–µ | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, –æ—Ç–∫–∞—Ç –Ω–∞ —Å—Ç–∞—Ä—É—é —Å–∏—Å—Ç–µ–º—É |
| –ü—Ä–æ–±–ª–µ–º—ã —Å VM | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–æ–µ | –ë—ç–∫–∞–ø—ã PostgreSQL –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤, snapshot VM |
| PWA –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç offline | –ù–∏–∑–∫–∞—è | –°—Ä–µ–¥–Ω–µ–µ | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ IndexedDB, fallback –Ω–∞ —Å—Ç–∞—Ä—ã–π URL |
| –ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ PostgreSQL | –ù–∏–∑–∫–∞—è | –°—Ä–µ–¥–Ω–µ–µ | –ò–Ω–¥–µ–∫—Å—ã, –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, Redis –∫—ç—à |

---

## üìÖ Timeline (–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–æ)

- **–ù–µ–¥–µ–ª—è 1**: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ Backend (FastAPI + SQLAlchemy)
- **–ù–µ–¥–µ–ª—è 2**: –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API
- **–ù–µ–¥–µ–ª—è 3**: –ê–¥–∞–ø—Ç–∞—Ü–∏—è PWA, Docker Compose, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ VM
- **–ù–µ–¥–µ–ª—è 4**: –î–µ–ø–ª–æ–π, –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫
- **–ù–µ–¥–µ–ª—è 5**: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É
- **–ù–µ–¥–µ–ª—è 6**: –§–∏–Ω–∞–ª—å–Ω—ã–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–ò—Ç–æ–≥–æ**: ~1.5 –º–µ—Å—è—Ü–∞ –¥–æ –ø–æ–ª–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

1. ‚ö° –í—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ batch < 50 –º—Å (vs 3000 –º—Å —Å–µ–π—á–∞—Å)
2. üöÄ Uptime > 99.9%
3. üìä –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 100+ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
4. üíæ –ù–µ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏
5. üîÑ Offline-—Ä–µ–∂–∏–º PWA —Ä–∞–±–æ—Ç–∞–µ—Ç
6. üìà Dashboard –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è < 200 –º—Å
7. üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã < 1000‚ÇΩ/–º–µ—Å

---

## üîó –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–í—ã–±–æ—Ä VM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞** (Yandex Cloud –∏–ª–∏ VK Cloud)
2. **–°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è** –¥–ª—è backend –∫–æ–¥–∞
3. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è FastAPI –ø—Ä–æ–µ–∫—Ç–∞**
4. **–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –º–æ–¥–µ–ª–µ–π SQLAlchemy**
5. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è API endpoints**
6. **–°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö**

---

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –∏–∑ –¢–ó:

1. **–ï—Å—Ç—å –ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤?**
   - –°–µ–π—á–∞—Å: –∏–º—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö PWA (–ø–æ–ª–µ "–ò–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞")
   - –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏
   - **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –¥–æ–±–∞–≤–∏—Ç—å API Key –∏–ª–∏ JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞

2. **–ö–∞–∫–∏–µ –æ—Ç—á—ë—Ç—ã –Ω—É–∂–Ω—ã?**
   - –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV (–ø–æ –¥–∞—Ç–µ, –∫–ª–∏–µ–Ω—Ç—É, –æ–ø–µ—Ä–∞—Ç–æ—Ä—É)
   - –≠–∫—Å–ø–æ—Ä—Ç –≤ Google Sheets (–ø—Ä–æ—Å—Ç–∞—è —Ç–∞–±–ª–∏—Ü–∞: –ö–ª–∏–µ–Ω—Ç | –ö–æ—Ä–æ–± | –®–ö | –í—Ä–µ–º—è | –û–ø–µ—Ä–∞—Ç–æ—Ä)
   - Dashboard —Å –∞–≥—Ä–µ–≥–∞—Ç–∞–º–∏ (–æ–ø–µ—Ä–∞—Ç–æ—Ä—ã, –∫–ª–∏–µ–Ω—Ç—ã, –∫–æ—Ä–æ–±–∞)
   - –õ–æ–≥–∏ —É–¥–∞–ª–µ–Ω–∏–π (REMOVE, BULK_REMOVE)

3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏?**
   - –°–µ–π—á–∞—Å –Ω–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
   - –¢–æ–ª—å–∫–æ Google Sheets –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ —ç–∫—Å–ø–æ—Ä—Ç–∞
   - **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: API endpoint –¥–ª—è webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å WB, 1C –∏ —Ç.–¥.)

4. **–ë—é–¥–∂–µ—Ç –Ω–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É?**
   - ~600-950‚ÇΩ/–º–µ—Å (VM + IP –∞–¥—Ä–µ—Å)
   - –£–∫–ª–∞–¥—ã–≤–∞–µ–º—Å—è –≤ 500-1000‚ÇΩ/–º–µ—Å

5. **–î–æ—Å—Ç—É–ø –∫ —Å—Ç–∞—Ä—ã–º –¥–∞–Ω–Ω—ã–º –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏?**
   - –î–∞, Google Sheets –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –≤ read-only —Ä–µ–∂–∏–º–µ
   - –í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ PostgreSQL
   - **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –ª–∏—Å—Ç—ã, —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ CSV –¥–ª—è –±—ç–∫–∞–ø–∞

---

## üéØ –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ–ª—É—á–∏–º:

‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –∑–∞–ø–∏—Å—å –±–∞—Ç—á–∞ –∑–∞ **< 50 –º—Å** (–≤–º–µ—Å—Ç–æ 3000 –º—Å)  
‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: 99.9% uptime, –Ω–µ—Ç –∫–≤–æ—Ç –∏ –ª–∏–º–∏—Ç–æ–≤  
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 100+ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–∫–∞–Ω–µ—Ä–æ–≤  
‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª—å**: –ø–æ–ª–Ω–æ–µ –≤–ª–∞–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π –∏ –¥–∞–Ω–Ω—ã–º–∏  
‚úÖ **–°—Ç–æ–∏–º–æ—Å—Ç—å**: ~600-950‚ÇΩ/–º–µ—Å (—Å–æ–ø–æ—Å—Ç–∞–≤–∏–º–æ —Å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º Sheets, –Ω–æ –Ω–∞ –ø–æ—Ä—è–¥–æ–∫ –ª—É—á—à–µ)  
‚úÖ **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞**: –±—ã—Å—Ç—Ä—ã–µ –æ—Ç—á—ë—Ç—ã –∏ –≤—ã–±–æ—Ä–∫–∏ –ø–æ –ª—é–±—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º  

---

**–ì–æ—Ç–æ–≤ –ø—Ä–∏—Å—Ç—É–ø–∏—Ç—å –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏! üöÄ**

