# Отладка фильтров по датам

## Проблема
При выборе диапазона дат `31.09 - 01.10` данные не отображаются, хотя при `01.10 - 01.10` всё работает.

## Причина
31 сентября не существует (в сентябре 30 дней), поэтому браузер может автоматически корректировать дату на 01.10, что приводит к некорректному диапазону `startDate > endDate`.

## Решение
Добавлена автоматическая валидация диапазона дат:
- Если `startDate > endDate`, то `endDate` автоматически устанавливается равным `startDate`
- Добавлено детальное логирование в консоль браузера

## Как проверить

### 1. Откройте DevTools (F12) → Console

### 2. Выберите даты в фильтре
Попробуйте разные комбинации:
- `01.11.2025 - 01.11.2025` (одна дата)
- `31.10.2025 - 01.11.2025` (диапазон)
- `01.11.2025 - 31.10.2025` (некорректный диапазон - должен автоматически исправиться)

### 3. Смотрите логи в консоли

#### Логи валидации фильтров:
```
📅 Filters updated: {startDate: "2025-11-01", endDate: "2025-11-01", ...}
```

Если диапазон некорректный, увидите:
```
⚠️ startDate > endDate, корректируем endDate: {startDate: "2025-11-01", endDate: "2025-10-31"}
```

#### Логи API запросов:
```
📡 API request: /dashboard/state?date=2025-11-01&date_end=2025-11-01
{
  filters: {startDate: "2025-11-01", endDate: "2025-11-01", ...},
  parsedParams: {date: "2025-11-01", date_end: "2025-11-01"}
}
```

#### Логи загрузки данных:
```
🔍 Loading data with filters: {startDate: "2025-11-01", endDate: "2025-11-01", ...}
Dashboard data: {feed: Array(49), operators: Array(1), ...}
```

### 4. Проверьте ответ API
В DevTools → Network → найдите запрос к `/dashboard/state` или `/dashboard/raw`:
- **Request URL**: должен содержать `date=2025-11-01&date_end=2025-11-01`
- **Response**: должен содержать массив `feed` или `logs` с данными

## Что проверять

### ✅ Работает корректно:
- Одна дата: `01.11 - 01.11` → показывает данные за 01.11
- Диапазон: `31.10 - 01.11` → показывает данные за 31.10 и 01.11
- Автокоррекция: `01.11 - 31.10` → автоматически исправляется на `01.11 - 01.11`

### ❌ Если данные не показываются:

1. **Проверьте, что данные есть в БД за эту дату**
   ```sql
   SELECT COUNT(*), DATE(ts) as date 
   FROM events 
   WHERE ts >= '2025-10-31' AND ts <= '2025-11-01 23:59:59'
   GROUP BY DATE(ts);
   ```

2. **Проверьте формат даты в API**
   - Фронтенд отправляет: `YYYY-MM-DD` (например, `2025-11-01`)
   - Бэкенд ожидает: `YYYY-MM-DD` или `MM.DD.YYYY`?
   
3. **Проверьте timezone**
   - Данные в БД могут быть в UTC
   - Фильтр на фронте использует локальное время браузера

4. **Проверьте логику бэкенда**
   - Если `date_end` не указан, бэкенд должен искать только за `date`
   - Если оба указаны, бэкенд должен искать в диапазоне `date <= ts <= date_end 23:59:59`

## Изменённые файлы

### `dashboard/src/App.jsx`
- Добавлена функция `handleFilterChange` с валидацией диапазона дат
- Добавлено логирование изменений фильтров

### `dashboard/src/api/client.js`
- Добавлено детальное логирование всех API запросов
- Добавлены недостающие параметры `date_end` и `city` в `getBoxes()`

## Следующие шаги

Если проблема сохраняется:
1. Скопируйте все логи из консоли браузера
2. Проверьте ответ API в Network tab
3. Проверьте данные в БД напрямую через SQL
4. Сообщите о проблеме с полными логами

